{"version":3,"file":"index.ts.js","sources":["../../src/content/index.ts"],"sourcesContent":["import type { TrackingPayload } from '@/types/tracking';\r\nimport { getSettings } from '@/storage/settings';\r\n\r\nconst BROADCAST_SOURCE = 'scrollwise-web';\r\nconst EXTENSION_BROADCAST_SOURCE = 'scrollwise-extension';\r\n\r\nconst broadcastLogoutToPage = () => {\r\n  try {\r\n    window.localStorage.removeItem('scrollwise-auth');\r\n  } catch (error) {\r\n    console.warn('scrollwise: unable to clear web auth storage', error);\r\n  }\r\n  window.postMessage({ source: EXTENSION_BROADCAST_SOURCE, origin: 'extension', type: 'AUTH_LOGOUT' }, '*');\r\n};\r\n\r\nconst readForcedLogoutFlag = () =>\r\n  new Promise<boolean>(resolve => {\r\n    if (!chrome?.storage?.local?.get) {\r\n      resolve(false);\r\n      return;\r\n    }\r\n    try {\r\n      chrome.storage.local.get('scrollwiseForceLogoutAt', store => {\r\n        resolve(Boolean(store?.scrollwiseForceLogoutAt));\r\n      });\r\n    } catch (error) {\r\n      console.warn('scrollwise: unable to read forced logout flag', error);\r\n      resolve(false);\r\n    }\r\n  });\r\n\r\nconst clearForcedLogoutFlag = () =>\r\n  new Promise<void>(resolve => {\r\n    if (!chrome?.storage?.local?.remove) {\r\n      resolve();\r\n      return;\r\n    }\r\n    try {\r\n      chrome.storage.local.remove('scrollwiseForceLogoutAt', () => resolve());\r\n    } catch (error) {\r\n      console.warn('scrollwise: unable to clear forced logout flag', error);\r\n      resolve();\r\n    }\r\n  });\r\n\r\nlet trackingEnabled = false;\r\nlet idleTimer: number | undefined;\r\nlet lastActionAt = Date.now();\r\nlet storageSyncInterval: number | undefined;\r\nconst BUFFER: TrackingPayload[] = [];\r\nlet runtimeInvalidated = false;\r\ntype ScrollKey = Window | HTMLElement;\r\ntype ScrollSource = 'scroll' | 'wheel' | 'touch' | 'key';\r\nconst MIN_SCROLL_DELTA = 8;\r\nconst IDLE_THRESHOLD_MS = 60_000;\r\nconst scrollOffsets = new WeakMap<ScrollKey, number>();\r\nscrollOffsets.set(window, window.scrollY);\r\n\r\nconst EVENT_LISTENER_OPTIONS: AddEventListenerOptions = { passive: true, capture: true };\r\nconst WHEEL_LISTENER_OPTIONS: AddEventListenerOptions = { passive: false, capture: true };\r\nconst KEYDOWN_LISTENER_OPTIONS: AddEventListenerOptions = { capture: true };\r\n\r\nconst pendingAnimationHandles = new Set<number>();\r\n\r\nconst resolveErrorMessage = (error: unknown) => {\r\n  if (error instanceof Error) return error.message ?? '';\r\n  if (typeof error === 'object' && error && 'message' in error) {\r\n    const message = (error as { message?: unknown }).message;\r\n    return typeof message === 'string' ? message : '';\r\n  }\r\n  return '';\r\n};\r\n\r\nconst isContextInvalidError = (error: unknown) => {\r\n  const message = resolveErrorMessage(error);\r\n  return /extension context invalidated|receiving end does not exist|no tab with id/i.test(message);\r\n};\r\n\r\nlet flushTimeout: number | undefined;\r\nlet listenersAttached = false;\r\n\r\nconst clearIdleTimer = () => {\r\n  if (!idleTimer) return;\r\n  window.clearTimeout(idleTimer);\r\n  idleTimer = undefined;\r\n};\r\n\r\nconst scheduleIdleTimer = () => {\r\n  clearIdleTimer();\r\n  if (!trackingEnabled || document.visibilityState !== 'visible') {\r\n    return;\r\n  }\r\n  idleTimer = window.setTimeout(() => {\r\n    idleTimer = undefined;\r\n    if (!trackingEnabled || document.visibilityState !== 'visible') {\r\n      return;\r\n    }\r\n    const now = Date.now();\r\n    const elapsed = Math.max(now - lastActionAt, IDLE_THRESHOLD_MS);\r\n      void pushEvent({\r\n      type: 'idle',\r\n      url: location.href,\r\n      domain: urlDomain(location.href),\r\n      durationMs: elapsed,\r\n      startedAt: new Date(now - elapsed).toISOString(),\r\n      metadata: { reason: 'pointer-idle', thresholdMs: IDLE_THRESHOLD_MS }\r\n    });\r\n    lastActionAt = now;\r\n    scheduleIdleTimer();\r\n  }, IDLE_THRESHOLD_MS);\r\n};\r\n\r\nconst cancelScheduledFlush = () => {\r\n  if (flushTimeout) {\r\n    window.clearTimeout(flushTimeout);\r\n    flushTimeout = undefined;\r\n  }\r\n};\r\n\r\nconst cancelScheduledMeasurements = () => {\r\n  pendingAnimationHandles.forEach(handle => window.cancelAnimationFrame(handle));\r\n  pendingAnimationHandles.clear();\r\n};\r\n\r\nconst markRuntimeInvalidated = () => {\r\n  if (runtimeInvalidated) return;\r\n  runtimeInvalidated = true;\r\n  trackingEnabled = false;\r\n  BUFFER.length = 0;\r\n  clearIdleTimer();\r\n  cancelScheduledFlush();\r\n  cancelScheduledMeasurements();\r\n  if (storageSyncInterval) {\r\n    window.clearInterval(storageSyncInterval);\r\n    storageSyncInterval = undefined;\r\n  }\r\n  detachTrackingListeners();\r\n  console.debug('scrollwise: extension runtime invalidated, suspending messaging');\r\n};\r\n\r\nconst isRuntimeAvailable = () => {\r\n  if (runtimeInvalidated) return false;\r\n  if (typeof chrome === 'undefined' || !chrome.runtime?.id) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    if (typeof chrome.runtime.getURL === 'function') {\r\n      chrome.runtime.getURL('');\r\n    }\r\n  } catch (error) {\r\n    if (isContextInvalidError(error)) {\r\n      markRuntimeInvalidated();\r\n    }\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\ntype MessageResult<T> = { ok: true; data: T | undefined } | { ok: false; error?: Error };\r\n\r\nconst safeSendMessage = <T = unknown>(message: unknown): Promise<MessageResult<T>> => {\r\n  if (!isRuntimeAvailable()) {\r\n    markRuntimeInvalidated();\r\n    return Promise.resolve({ ok: false });\r\n  }\r\n\r\n  return new Promise<MessageResult<T>>(resolve => {\r\n    const finalizeFailure = (error?: unknown) => {\r\n      if (isContextInvalidError(error)) {\r\n        markRuntimeInvalidated();\r\n      }\r\n      resolve({ ok: false, error: error instanceof Error ? error : undefined });\r\n    };\r\n\r\n    try {\r\n      const maybePromise = chrome.runtime.sendMessage(message, (response: T | undefined) => {\r\n        const runtimeError = chrome.runtime.lastError;\r\n        if (runtimeError) {\r\n          finalizeFailure(runtimeError);\r\n          return;\r\n        }\r\n        resolve({ ok: true, data: response });\r\n      });\r\n\r\n      if (typeof maybePromise !== 'undefined' && typeof (maybePromise as Promise<unknown>).then === 'function') {\r\n        (maybePromise as Promise<T | undefined>)\r\n          .then(response => {\r\n            resolve({ ok: true, data: response });\r\n          })\r\n          .catch(finalizeFailure);\r\n      }\r\n    } catch (error) {\r\n      finalizeFailure(error);\r\n    }\r\n  });\r\n};\r\n\r\ntype PageAuthSnapshot = {\r\n  accessToken: string;\r\n  refreshToken?: string;\r\n  user?: { id?: string; email?: string; displayName?: string; avatarUrl?: string };\r\n};\r\n\r\nconst readPageAuth = (): PageAuthSnapshot | undefined => {\r\n  if (!(window.location.protocol === 'http:' || window.location.protocol === 'https:')) {\r\n    return undefined;\r\n  }\r\n  try {\r\n    const raw = window.localStorage.getItem('scrollwise-auth');\r\n    if (!raw) return undefined;\r\n    const parsed = JSON.parse(raw);\r\n    if (!parsed?.accessToken) return undefined;\r\n    return {\r\n      accessToken: parsed.accessToken,\r\n      refreshToken: parsed.refreshToken,\r\n      user: parsed.user\r\n    };\r\n  } catch (error) {\r\n    console.warn('scrollwise: unable to parse local auth', error);\r\n    return undefined;\r\n  }\r\n};\r\n\r\nconst authHash = (auth?: PageAuthSnapshot | null) => {\r\n  if (!auth) return null;\r\n  const userId = auth.user?.id ?? '';\r\n  return `${auth.accessToken}:${auth.refreshToken ?? ''}:${userId}`;\r\n};\r\n\r\nlet lastAuthSignature: string | null = null;\r\n\r\nconst broadcastAuthSnapshotToPage = (snapshot: PageAuthSnapshot) => {\r\n  if (!snapshot?.accessToken) return;\r\n  window.postMessage(\r\n    { source: EXTENSION_BROADCAST_SOURCE, origin: 'extension', type: 'AUTH_UPDATE', payload: snapshot },\r\n    '*'\r\n  );\r\n};\r\n\r\nconst persistPageSnapshot = (snapshot: PageAuthSnapshot) => {\r\n  if (!snapshot?.accessToken) return;\r\n  try {\r\n    window.localStorage.setItem('scrollwise-auth', JSON.stringify(snapshot));\r\n  } catch (error) {\r\n    console.warn('scrollwise: unable to persist web auth storage', error);\r\n  }\r\n};\r\n\r\nconst applyAuthSnapshotFromExtension = (partial: Partial<PageAuthSnapshot> | undefined) => {\r\n  if (!partial) return;\r\n  const existing = readPageAuth();\r\n  const next: PageAuthSnapshot = {\r\n    accessToken: partial.accessToken ?? existing?.accessToken ?? '',\r\n    refreshToken: partial.refreshToken ?? existing?.refreshToken,\r\n    user: partial.user ?? existing?.user\r\n  };\r\n\r\n  if (!next.accessToken || !next.refreshToken || !next.user) {\r\n    return;\r\n  }\r\n\r\n  persistPageSnapshot(next);\r\n  broadcastAuthSnapshotToPage(next);\r\n  lastAuthSignature = authHash(next);\r\n};\r\n\r\nconst syncFromPageStorage = async (activateTracking = false) => {\r\n  const snapshot = readPageAuth();\r\n  const nextSignature = authHash(snapshot);\r\n  const runtimeReady = isRuntimeAvailable();\r\n\r\n  if (!runtimeReady) {\r\n    return;\r\n  }\r\n\r\n  const forcedLogout = await readForcedLogoutFlag();\r\n  if (forcedLogout && snapshot) {\r\n    broadcastLogoutToPage();\r\n    lastAuthSignature = null;\r\n    await clearForcedLogoutFlag();\r\n    return;\r\n  }\r\n\r\n  const shouldActivate = activateTracking || (snapshot && nextSignature !== lastAuthSignature && !lastAuthSignature);\r\n\r\n  if (snapshot && nextSignature !== lastAuthSignature) {\r\n    void safeSendMessage({\r\n      type: 'AUTH_UPDATE',\r\n      payload: {\r\n        accessToken: snapshot.accessToken,\r\n        refreshToken: snapshot.refreshToken,\r\n        user: snapshot.user,\r\n        trackingEnabled: shouldActivate ? true : undefined\r\n      }\r\n    });\r\n  }\r\n\r\n  if (!snapshot && lastAuthSignature) {\r\n    void safeSendMessage({ type: 'AUTH_LOGOUT' });\r\n  }\r\n\r\n  lastAuthSignature = nextSignature;\r\n};\r\n\r\nvoid syncFromPageStorage(true);\r\n\r\nwindow.addEventListener('storage', () => {\r\n  void syncFromPageStorage();\r\n});\r\n\r\nstorageSyncInterval = window.setInterval(() => {\r\n  void syncFromPageStorage();\r\n}, 2000);\r\n\r\nwindow.addEventListener('message', event => {\r\n  if (event.source !== window) {\r\n    return;\r\n  }\r\n\r\n  const data = event.data;\r\n  if (!data || typeof data !== 'object' || data.source !== BROADCAST_SOURCE) {\r\n    return;\r\n  }\r\n\r\n  if (!isRuntimeAvailable()) {\r\n    return;\r\n  }\r\n\r\n  if (data.type === 'AUTH_UPDATE') {\r\n    const payload = data.payload ?? {};\r\n    lastAuthSignature = authHash({\r\n      accessToken: payload.accessToken,\r\n      refreshToken: payload.refreshToken,\r\n      user: payload.user\r\n    }) ?? lastAuthSignature;\r\n    void safeSendMessage({\r\n      type: 'AUTH_UPDATE',\r\n      payload: {\r\n        accessToken: payload.accessToken,\r\n        refreshToken: payload.refreshToken,\r\n        user: payload.user,\r\n        trackingEnabled: payload.trackingEnabled\r\n      }\r\n    });\r\n  }\r\n\r\n  if (data.type === 'AUTH_LOGOUT') {\r\n    void safeSendMessage({ type: 'AUTH_LOGOUT' });\r\n    lastAuthSignature = null;\r\n  }\r\n});\r\n\r\nconst setTrackingEnabled = (enabled: boolean) => {\r\n  trackingEnabled = enabled;\r\n  if (!enabled) {\r\n    BUFFER.length = 0;\r\n    clearIdleTimer();\r\n  } else {\r\n    lastActionAt = Date.now();\r\n    scheduleIdleTimer();\r\n  }\r\n};\r\n\r\nconst flushBuffer = () => {\r\n  if (!BUFFER.length) return;\r\n  if (!isRuntimeAvailable()) {\r\n    scheduleFlush();\r\n    return;\r\n  }\r\n  const batch = [...BUFFER];\r\n  BUFFER.length = 0;\r\n  safeSendMessage({ type: 'TRACKING_EVENT', payload: batch }).then(result => {\r\n    if (!result.ok) {\r\n      // requeue if sending fails so we attempt again once connection resumes\r\n      BUFFER.unshift(...batch);\r\n      scheduleFlush();\r\n    }\r\n  });\r\n};\r\n\r\nconst scheduleFlush = () => {\r\n  if (flushTimeout) window.clearTimeout(flushTimeout);\r\n  flushTimeout = window.setTimeout(flushBuffer, 1500);\r\n};\r\n\r\nconst pushEvent = async (event: TrackingPayload) => {\r\n  if (!trackingEnabled) return;\r\n  try {\r\n    const settings = await getSettings();\r\n    const domain = event.domain || urlDomain(event.url || location.href);\r\n    if (settings.blocklist.includes(domain)) return;\r\n  } catch (e) {\r\n    // ignore settings read errors â€” do not block event capture\r\n  }\r\n\r\n  if (!isRuntimeAvailable()) {\r\n    markRuntimeInvalidated();\r\n    return;\r\n  }\r\n\r\n  BUFFER.push(event);\r\n  if (BUFFER.length >= 8) {\r\n    flushBuffer();\r\n  } else {\r\n    scheduleFlush();\r\n  }\r\n};\r\n\r\nconst urlDomain = (url: string) => {\r\n  try {\r\n    return new URL(url).hostname.replace('www.', '');\r\n  } catch {\r\n    return location.hostname;\r\n  }\r\n};\r\n\r\nconst resolveScrollTarget = (target: EventTarget | null): ScrollKey => {\r\n  if (!target) return window;\r\n  if (target === document || target === document.body || target === document.documentElement) {\r\n    return window;\r\n  }\r\n  if (target instanceof HTMLElement) {\r\n    return target;\r\n  }\r\n  if (target instanceof Element) {\r\n    return target as unknown as HTMLElement;\r\n  }\r\n  return window;\r\n};\r\n\r\nconst readScrollOffset = (target: ScrollKey) => {\r\n  if (target === window) {\r\n    return window.scrollY;\r\n  }\r\n\r\n  const value = (target as HTMLElement).scrollTop;\r\n  return Number.isFinite(value) ? value : 0;\r\n};\r\n\r\nconst seedScrollOffset = (target: ScrollKey) => {\r\n  if (!scrollOffsets.has(target)) {\r\n    scrollOffsets.set(target, readScrollOffset(target));\r\n  }\r\n};\r\n\r\nconst describeScrollTarget = (target: ScrollKey) => {\r\n  if (target === window) return 'window';\r\n  const element = target as HTMLElement;\r\n  const tag = element.tagName?.toLowerCase() ?? 'element';\r\n  const id = element.id ? `#${element.id}` : '';\r\n  let classList = '';\r\n  const rawClassName = typeof element.className === 'string'\r\n    ? element.className\r\n    : typeof (element.className as SVGAnimatedString | undefined)?.baseVal === 'string'\r\n      ? (element.className as SVGAnimatedString).baseVal\r\n      : '';\r\n  if (rawClassName) {\r\n    const tokens = rawClassName\r\n      .split(/\\s+/)\r\n      .filter(Boolean)\r\n      .slice(0, 2)\r\n      .map((cls: string) => `.${cls}`)\r\n      .join('');\r\n    classList = tokens;\r\n  }\r\n  return `${tag}${id}${classList}`;\r\n};\r\n\r\nconst recordScrollForTarget = (target: ScrollKey, source: ScrollSource = 'scroll') => {\r\n  seedScrollOffset(target);\r\n  const previous = scrollOffsets.get(target) ?? 0;\r\n  const current = readScrollOffset(target);\r\n  const delta = Math.abs(current - previous);\r\n  if (delta < MIN_SCROLL_DELTA) {\r\n    return;\r\n  }\r\n  scrollOffsets.set(target, current);\r\n  const now = Date.now();\r\n    void pushEvent({\r\n    type: 'scroll',\r\n    url: location.href,\r\n    domain: urlDomain(location.href),\r\n    scrollDistance: delta,\r\n    durationMs: now - lastActionAt,\r\n    startedAt: new Date(lastActionAt).toISOString(),\r\n    metadata: {\r\n      viewportHeight: window.innerHeight,\r\n      container: describeScrollTarget(target),\r\n      source\r\n    }\r\n  });\r\n  lastActionAt = now;\r\n};\r\n\r\nconst scheduleScrollMeasurement = (target: ScrollKey, source: ScrollSource, immediate = false) => {\r\n  if (immediate) {\r\n    recordScrollForTarget(target, source);\r\n    return;\r\n  }\r\n\r\n  const handle = window.requestAnimationFrame(() => {\r\n    pendingAnimationHandles.delete(handle);\r\n    recordScrollForTarget(target, source);\r\n  });\r\n  pendingAnimationHandles.add(handle);\r\n};\r\n\r\nconst keyScrollKeys = new Set(['ArrowDown', 'ArrowUp', 'PageDown', 'PageUp', 'Home', 'End', 'Space']);\r\n\r\nconst handleScrollEvent = (event: Event) => {\r\n  resetIdleTimer();\r\n  const target = resolveScrollTarget(event.target);\r\n  scheduleScrollMeasurement(target, 'scroll', true);\r\n};\r\n\r\nconst handleWheel = (event: WheelEvent) => {\r\n  resetIdleTimer();\r\n  const target = resolveScrollTarget(event.target);\r\n  if (!scrollOffsets.has(target)) {\r\n    seedScrollOffset(target);\r\n  }\r\n  scheduleScrollMeasurement(target, 'wheel');\r\n};\r\n\r\nconst handleTouchMove = (event: TouchEvent) => {\r\n  resetIdleTimer();\r\n  const target = resolveScrollTarget(event.target);\r\n  scheduleScrollMeasurement(target, 'touch');\r\n};\r\n\r\nconst handleKeyDown = (event: KeyboardEvent) => {\r\n  if (!keyScrollKeys.has(event.key)) {\r\n    return;\r\n  }\r\n  resetIdleTimer();\r\n  const activeElement = document.activeElement as HTMLElement | null;\r\n  const target = activeElement && activeElement !== document.body ? activeElement : window;\r\n  seedScrollOffset(target);\r\n  scheduleScrollMeasurement(target, 'key');\r\n};\r\n\r\nconst handleClick = (event: MouseEvent) => {\r\n  const now = Date.now();\r\n    void pushEvent({\r\n    type: 'click',\r\n    url: location.href,\r\n    domain: urlDomain(location.href),\r\n    durationMs: now - lastActionAt,\r\n    startedAt: new Date(lastActionAt).toISOString(),\r\n    metadata: {\r\n      tag: (event.target as HTMLElement)?.tagName,\r\n      x: event.clientX,\r\n      y: event.clientY\r\n    }\r\n  });\r\n  lastActionAt = now;\r\n  resetIdleTimer();\r\n};\r\n\r\nconst resetIdleTimer = () => {\r\n  if (!trackingEnabled) {\r\n    return;\r\n  }\r\n  scheduleIdleTimer();\r\n};\r\n\r\nconst handleMouseMove = () => {\r\n  lastActionAt = Date.now();\r\n  resetIdleTimer();\r\n};\r\n\r\nconst handleVisibilityChange = () => {\r\n  const nowVisible = document.visibilityState === 'visible';\r\n  const now = Date.now();\r\n    void pushEvent({\r\n    type: nowVisible ? 'focus' : 'blur',\r\n    url: location.href,\r\n    domain: urlDomain(location.href),\r\n    startedAt: new Date(now).toISOString()\r\n  });\r\n  lastActionAt = now;\r\n  if (!nowVisible) {\r\n    clearIdleTimer();\r\n    flushBuffer();\r\n  } else {\r\n    scheduleIdleTimer();\r\n  }\r\n};\r\n\r\nconst handleBeforeUnload = () => {\r\n  clearIdleTimer();\r\n  lastActionAt = Date.now();\r\n  flushBuffer();\r\n};\r\n\r\nconst handlePageHide = () => {\r\n  clearIdleTimer();\r\n  lastActionAt = Date.now();\r\n  flushBuffer();\r\n};\r\n\r\nfunction attachTrackingListeners() {\r\n  if (listenersAttached) return;\r\n  document.addEventListener('scroll', handleScrollEvent, EVENT_LISTENER_OPTIONS);\r\n  document.addEventListener('wheel', handleWheel, WHEEL_LISTENER_OPTIONS);\r\n  document.addEventListener('touchmove', handleTouchMove, EVENT_LISTENER_OPTIONS);\r\n  document.addEventListener('keydown', handleKeyDown, KEYDOWN_LISTENER_OPTIONS);\r\n  document.addEventListener('click', handleClick, { passive: true });\r\n  document.addEventListener('mousemove', handleMouseMove, { passive: true });\r\n  document.addEventListener('visibilitychange', handleVisibilityChange);\r\n  window.addEventListener('beforeunload', handleBeforeUnload);\r\n  window.addEventListener('pagehide', handlePageHide);\r\n  listenersAttached = true;\r\n}\r\n\r\nfunction detachTrackingListeners() {\r\n  if (!listenersAttached) return;\r\n  document.removeEventListener('scroll', handleScrollEvent, EVENT_LISTENER_OPTIONS);\r\n  document.removeEventListener('wheel', handleWheel, WHEEL_LISTENER_OPTIONS);\r\n  document.removeEventListener('touchmove', handleTouchMove, EVENT_LISTENER_OPTIONS);\r\n  document.removeEventListener('keydown', handleKeyDown, KEYDOWN_LISTENER_OPTIONS);\r\n  document.removeEventListener('click', handleClick);\r\n  document.removeEventListener('mousemove', handleMouseMove);\r\n  document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n  window.removeEventListener('beforeunload', handleBeforeUnload);\r\n  window.removeEventListener('pagehide', handlePageHide);\r\n  cancelScheduledMeasurements();\r\n  listenersAttached = false;\r\n}\r\n\r\nif (isRuntimeAvailable()) {\r\n  chrome.runtime.onMessage.addListener((message, _sender, sendResponse) => {\r\n    if (message.type === 'SYNC_TRACKING') {\r\n      setTrackingEnabled(Boolean(message.enabled));\r\n      sendResponse({ enabled: trackingEnabled });\r\n      return;\r\n    }\r\n\r\n    if (message.type === 'AUTH_STATE_PUSH') {\r\n      applyAuthSnapshotFromExtension(message.payload);\r\n      sendResponse({ ok: true });\r\n      return;\r\n    }\r\n\r\n    if (message.type === 'AUTH_LOGOUT_BROADCAST') {\r\n      setTrackingEnabled(false);\r\n      BUFFER.length = 0;\r\n      clearIdleTimer();\r\n      cancelScheduledFlush();\r\n      broadcastLogoutToPage();\r\n      lastAuthSignature = null;\r\n      sendResponse({ ok: true });\r\n      return;\r\n    }\r\n  });\r\n}\r\n\r\nresetIdleTimer();\r\n\r\nsafeSendMessage<{ enabled?: boolean }>({ type: 'TRACKING_STATUS_REQUEST' }).then(result => {\r\n  if (result.ok) {\r\n    setTrackingEnabled(Boolean(result.data?.enabled));\r\n  }\r\n});\r\n\r\nsafeSendMessage<{ state?: PageAuthSnapshot }>({ type: 'AUTH_STATE_REQUEST' }).then(result => {\r\n  if (result.ok && result.data?.state) {\r\n    applyAuthSnapshotFromExtension(result.data.state);\r\n  }\r\n});\r\n\r\nattachTrackingListeners();\r\n"],"names":["BROADCAST_SOURCE","EXTENSION_BROADCAST_SOURCE","broadcastLogoutToPage","error","readForcedLogoutFlag","resolve","_b","_a","store","clearForcedLogoutFlag","trackingEnabled","idleTimer","lastActionAt","storageSyncInterval","BUFFER","runtimeInvalidated","MIN_SCROLL_DELTA","IDLE_THRESHOLD_MS","scrollOffsets","EVENT_LISTENER_OPTIONS","WHEEL_LISTENER_OPTIONS","KEYDOWN_LISTENER_OPTIONS","pendingAnimationHandles","resolveErrorMessage","message","isContextInvalidError","flushTimeout","listenersAttached","clearIdleTimer","scheduleIdleTimer","now","elapsed","pushEvent","urlDomain","cancelScheduledFlush","cancelScheduledMeasurements","handle","markRuntimeInvalidated","detachTrackingListeners","isRuntimeAvailable","safeSendMessage","finalizeFailure","maybePromise","response","runtimeError","readPageAuth","raw","parsed","authHash","auth","userId","lastAuthSignature","broadcastAuthSnapshotToPage","snapshot","persistPageSnapshot","applyAuthSnapshotFromExtension","partial","existing","next","syncFromPageStorage","activateTracking","nextSignature","shouldActivate","event","data","payload","setTrackingEnabled","enabled","flushBuffer","scheduleFlush","batch","result","settings","getSettings","domain","url","resolveScrollTarget","target","readScrollOffset","value","seedScrollOffset","describeScrollTarget","element","tag","id","classList","rawClassName","cls","recordScrollForTarget","source","previous","current","delta","scheduleScrollMeasurement","immediate","keyScrollKeys","handleScrollEvent","resetIdleTimer","handleWheel","handleTouchMove","handleKeyDown","activeElement","handleClick","handleMouseMove","handleVisibilityChange","nowVisible","handleBeforeUnload","handlePageHide","attachTrackingListeners","_sender","sendResponse"],"mappings":"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"}