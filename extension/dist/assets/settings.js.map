{"version":3,"file":"settings.js","sources":["../../src/storage/settings.ts"],"sourcesContent":["export interface ExtensionSettings {\r\n  blocklist: string[];\r\n  dataRetentionDays: number; // number of days to keep queued/local data\r\n}\r\n\r\nconst STORAGE_KEY = 'scrollwise-settings';\r\n\r\nexport const DEFAULT_SETTINGS: ExtensionSettings = {\r\n  blocklist: [],\r\n  dataRetentionDays: 30\r\n};\r\n\r\nconst normalizeDomain = (domain: string) => {\r\n  if (!domain) return '';\r\n  let working = domain.trim().toLowerCase();\r\n  if (!working) return '';\r\n  if (!/^https?:\\/\\//.test(working)) {\r\n    working = `https://${working}`;\r\n  }\r\n  try {\r\n    const url = new URL(working);\r\n    return url.hostname.replace(/^www\\./, '');\r\n  } catch {\r\n    return working\r\n      .replace(/^https?:\\/\\//, '')\r\n      .replace(/^www\\./, '')\r\n      .split('/')[0]\r\n      .trim();\r\n  }\r\n};\r\n\r\nconst clampRetention = (value: number) => {\r\n  const coerced = Number.isFinite(value) ? Math.round(value) : DEFAULT_SETTINGS.dataRetentionDays;\r\n  return Math.max(1, Math.min(365, coerced));\r\n};\r\n\r\nconst dedupe = (items: string[]) => Array.from(new Set(items.filter(Boolean)));\r\n\r\nconst mergeSettings = (base: ExtensionSettings, update: Partial<ExtensionSettings>): ExtensionSettings => {\r\n  const merged: ExtensionSettings = {\r\n    blocklist: base.blocklist,\r\n    dataRetentionDays: base.dataRetentionDays\r\n  };\r\n\r\n  if (update.blocklist) {\r\n    merged.blocklist = dedupe(update.blocklist.map(normalizeDomain).concat(base.blocklist)).filter(Boolean);\r\n  }\r\n\r\n  if (typeof update.dataRetentionDays !== 'undefined') {\r\n    merged.dataRetentionDays = clampRetention(update.dataRetentionDays);\r\n  }\r\n\r\n  return {\r\n    blocklist: dedupe(merged.blocklist.map(normalizeDomain)).filter(Boolean),\r\n    dataRetentionDays: clampRetention(merged.dataRetentionDays)\r\n  };\r\n};\r\n\r\nconst writeSettings = async (settings: ExtensionSettings) => {\r\n  const normalised = {\r\n    blocklist: dedupe(settings.blocklist.map(normalizeDomain)).filter(Boolean),\r\n    dataRetentionDays: clampRetention(settings.dataRetentionDays)\r\n  } as ExtensionSettings;\r\n  await chrome.storage.local.set({ [STORAGE_KEY]: normalised });\r\n  return normalised;\r\n};\r\n\r\nexport const getSettings = async (): Promise<ExtensionSettings> => {\r\n  const raw = await chrome.storage.local.get(STORAGE_KEY);\r\n  const data = raw[STORAGE_KEY] as Partial<ExtensionSettings> | undefined;\r\n  if (!data) {\r\n    return DEFAULT_SETTINGS;\r\n  }\r\n  return {\r\n    blocklist: dedupe((data.blocklist ?? DEFAULT_SETTINGS.blocklist).map(normalizeDomain)).filter(Boolean),\r\n    dataRetentionDays: clampRetention(data.dataRetentionDays ?? DEFAULT_SETTINGS.dataRetentionDays)\r\n  };\r\n};\r\n\r\nexport const setSettings = async (settings: Partial<ExtensionSettings>) => {\r\n  const current = await getSettings();\r\n  const next = mergeSettings(current, settings);\r\n  return writeSettings(next);\r\n};\r\n\r\nexport const addToBlocklist = async (domain: string) => {\r\n  const normalized = normalizeDomain(domain);\r\n  if (!normalized) {\r\n    return getSettings();\r\n  }\r\n  const current = await getSettings();\r\n  if (current.blocklist.includes(normalized)) {\r\n    return current;\r\n  }\r\n  return writeSettings({\r\n    blocklist: [...current.blocklist, normalized],\r\n    dataRetentionDays: current.dataRetentionDays\r\n  });\r\n};\r\n\r\nexport const removeFromBlocklist = async (domain: string) => {\r\n  const normalized = normalizeDomain(domain);\r\n  const current = await getSettings();\r\n  if (!current.blocklist.includes(normalized)) {\r\n    return current;\r\n  }\r\n  return writeSettings({\r\n    blocklist: current.blocklist.filter(entry => entry !== normalized),\r\n    dataRetentionDays: current.dataRetentionDays\r\n  });\r\n};\r\n\r\nexport const resetSettings = async () => writeSettings(DEFAULT_SETTINGS);\r\n\r\nexport default {\r\n  getSettings,\r\n  setSettings,\r\n  addToBlocklist,\r\n  removeFromBlocklist,\r\n  resetSettings\r\n};\r\n"],"names":["STORAGE_KEY","DEFAULT_SETTINGS","normalizeDomain","domain","working","clampRetention","value","coerced","dedupe","items","mergeSettings","base","update","merged","writeSettings","settings","normalised","getSettings","data","setSettings","current","next","addToBlocklist","normalized","removeFromBlocklist","entry","resetSettings"],"mappings":"AAKA,MAAMA,EAAc,sBAEPC,EAAsC,CACjD,UAAW,CAAA,EACX,kBAAmB,EACrB,EAEMC,EAAmBC,GAAmB,CAC1C,GAAI,CAACA,EAAQ,MAAO,GACpB,IAAIC,EAAUD,EAAO,KAAA,EAAO,YAAA,EAC5B,GAAI,CAACC,EAAS,MAAO,GAChB,eAAe,KAAKA,CAAO,IAC9BA,EAAU,WAAWA,CAAO,IAE9B,GAAI,CAEF,OADY,IAAI,IAAIA,CAAO,EAChB,SAAS,QAAQ,SAAU,EAAE,CAC1C,MAAQ,CACN,OAAOA,EACJ,QAAQ,eAAgB,EAAE,EAC1B,QAAQ,SAAU,EAAE,EACpB,MAAM,GAAG,EAAE,CAAC,EACZ,KAAA,CACL,CACF,EAEMC,EAAkBC,GAAkB,CACxC,MAAMC,EAAU,OAAO,SAASD,CAAK,EAAI,KAAK,MAAMA,CAAK,EAAIL,EAAiB,kBAC9E,OAAO,KAAK,IAAI,EAAG,KAAK,IAAI,IAAKM,CAAO,CAAC,CAC3C,EAEMC,EAAUC,GAAoB,MAAM,KAAK,IAAI,IAAIA,EAAM,OAAO,OAAO,CAAC,CAAC,EAEvEC,EAAgB,CAACC,EAAyBC,IAA0D,CACxG,MAAMC,EAA4B,CAChC,UAAWF,EAAK,UAChB,kBAAmBA,EAAK,iBAAA,EAG1B,OAAIC,EAAO,YACTC,EAAO,UAAYL,EAAOI,EAAO,UAAU,IAAIV,CAAe,EAAE,OAAOS,EAAK,SAAS,CAAC,EAAE,OAAO,OAAO,GAGpG,OAAOC,EAAO,kBAAsB,MACtCC,EAAO,kBAAoBR,EAAeO,EAAO,iBAAiB,GAG7D,CACL,UAAWJ,EAAOK,EAAO,UAAU,IAAIX,CAAe,CAAC,EAAE,OAAO,OAAO,EACvE,kBAAmBG,EAAeQ,EAAO,iBAAiB,CAAA,CAE9D,EAEMC,EAAgB,MAAOC,GAAgC,CAC3D,MAAMC,EAAa,CACjB,UAAWR,EAAOO,EAAS,UAAU,IAAIb,CAAe,CAAC,EAAE,OAAO,OAAO,EACzE,kBAAmBG,EAAeU,EAAS,iBAAiB,CAAA,EAE9D,aAAM,OAAO,QAAQ,MAAM,IAAI,CAAE,CAACf,CAAW,EAAGgB,EAAY,EACrDA,CACT,EAEaC,EAAc,SAAwC,CAEjE,MAAMC,GADM,MAAM,OAAO,QAAQ,MAAM,IAAIlB,CAAW,GACrCA,CAAW,EAC5B,OAAKkB,EAGE,CACL,UAAWV,GAAQU,EAAK,WAAajB,EAAiB,WAAW,IAAIC,CAAe,CAAC,EAAE,OAAO,OAAO,EACrG,kBAAmBG,EAAea,EAAK,mBAAqBjB,EAAiB,iBAAiB,CAAA,EAJvFA,CAMX,EAEakB,EAAc,MAAOJ,GAAyC,CACzE,MAAMK,EAAU,MAAMH,EAAA,EAChBI,EAAOX,EAAcU,EAASL,CAAQ,EAC5C,OAAOD,EAAcO,CAAI,CAC3B,EAEaC,EAAiB,MAAOnB,GAAmB,CACtD,MAAMoB,EAAarB,EAAgBC,CAAM,EACzC,GAAI,CAACoB,EACH,OAAON,EAAA,EAET,MAAMG,EAAU,MAAMH,EAAA,EACtB,OAAIG,EAAQ,UAAU,SAASG,CAAU,EAChCH,EAEFN,EAAc,CACnB,UAAW,CAAC,GAAGM,EAAQ,UAAWG,CAAU,EAC5C,kBAAmBH,EAAQ,iBAAA,CAC5B,CACH,EAEaI,EAAsB,MAAOrB,GAAmB,CAC3D,MAAMoB,EAAarB,EAAgBC,CAAM,EACnCiB,EAAU,MAAMH,EAAA,EACtB,OAAKG,EAAQ,UAAU,SAASG,CAAU,EAGnCT,EAAc,CACnB,UAAWM,EAAQ,UAAU,OAAOK,GAASA,IAAUF,CAAU,EACjE,kBAAmBH,EAAQ,iBAAA,CAC5B,EALQA,CAMX,EAEaM,EAAgB,SAAYZ,EAAcb,CAAgB"}