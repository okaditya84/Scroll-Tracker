{"version":3,"file":"index.ts2.js","sources":["../../src/storage/queue.ts","../../src/utils/api.ts","../../src/background/index.ts"],"sourcesContent":["import type { TrackingPayload } from '@/types/tracking';\r\n\r\nconst QUEUE_KEY = 'scrollwise-event-queue';\r\n\r\nexport interface QueuedEvent {\r\n  id: string;\r\n  event: TrackingPayload;\r\n}\r\n\r\nconst createQueuedEvent = (event: TrackingPayload): QueuedEvent => ({\r\n  id: typeof crypto !== 'undefined' && 'randomUUID' in crypto ? crypto.randomUUID() : `${Date.now()}-${Math.random()}`,\r\n  event\r\n});\r\n\r\nconst normalizeQueue = (raw: unknown): QueuedEvent[] => {\r\n  if (!Array.isArray(raw)) {\r\n    return [];\r\n  }\r\n\r\n  return raw.map(item => {\r\n    if (item && typeof item === 'object' && 'id' in item && 'event' in item) {\r\n      const candidate = item as { id: string; event: TrackingPayload };\r\n      if (typeof candidate.id === 'string' && candidate.event) {\r\n        return candidate;\r\n      }\r\n    }\r\n    return createQueuedEvent(item as TrackingPayload);\r\n  });\r\n};\r\n\r\nconst writeQueue = async (queue: QueuedEvent[]) => {\r\n  if (queue.length) {\r\n    await chrome.storage.local.set({ [QUEUE_KEY]: queue });\r\n  } else {\r\n    await chrome.storage.local.remove(QUEUE_KEY);\r\n  }\r\n};\r\n\r\nconst readQueue = async (): Promise<QueuedEvent[]> => {\r\n  const stored = await chrome.storage.local.get(QUEUE_KEY);\r\n  const raw = stored[QUEUE_KEY];\r\n  const normalized = normalizeQueue(raw);\r\n  const needsUpgrade = Array.isArray(raw) && raw.some(item => !(item && typeof item === 'object' && 'id' in item && 'event' in item));\r\n  if (needsUpgrade && normalized.length) {\r\n    await writeQueue(normalized);\r\n  }\r\n  return normalized;\r\n};\r\n\r\nexport const enqueueEvents = async (events: TrackingPayload[]) => {\r\n  if (!events.length) return [] as string[];\r\n  const existing = await readQueue();\r\n  const next = events.map(createQueuedEvent);\r\n  await writeQueue([...existing, ...next]);\r\n  return next.map(item => item.id);\r\n};\r\n\r\nexport const getQueuedEvents = async () => readQueue();\r\n\r\nexport const removeQueuedEvents = async (ids: string[]) => {\r\n  if (!ids.length) return;\r\n  const existing = await readQueue();\r\n  const filtered = existing.filter(item => !ids.includes(item.id));\r\n  await writeQueue(filtered);\r\n};\r\n\r\nexport const clearQueue = async () => {\r\n  await chrome.storage.local.remove(QUEUE_KEY);\r\n};\r\n","import type { AuthState } from '../storage/auth';\r\nimport { getQueuedEvents, removeQueuedEvents } from '../storage/queue';\r\n\r\ntype ResolvedBase = { base: string; appended: boolean };\r\n\r\nconst stripTrailingSlash = (value: string) => value.replace(/\\/+$/, '');\r\nconst hasApiSegment = (value: string) => /\\/api(?:\\/|$)/i.test(value);\r\n\r\nconst resolveApiBase = (raw?: string): ResolvedBase | undefined => {\r\n  if (!raw) return undefined;\r\n  const trimmed = raw.trim();\r\n  if (!trimmed) return undefined;\r\n\r\n  const normalised = stripTrailingSlash(trimmed);\r\n\r\n  try {\r\n    const url = new URL(normalised);\r\n    const path = stripTrailingSlash(url.pathname || '');\r\n    if (!path || path === '') {\r\n      url.pathname = '/api';\r\n      return { base: stripTrailingSlash(url.toString()), appended: true };\r\n    }\r\n    if (hasApiSegment(path)) {\r\n      url.pathname = path;\r\n      return { base: stripTrailingSlash(url.toString()), appended: false };\r\n    }\r\n    url.pathname = `${path}/api`;\r\n    return { base: stripTrailingSlash(url.toString()), appended: true };\r\n  } catch {\r\n    if (hasApiSegment(normalised)) {\r\n      return { base: normalised, appended: false };\r\n    }\r\n    return { base: `${normalised}/api`, appended: true };\r\n  }\r\n};\r\n\r\nconst resolvedBase = resolveApiBase(import.meta.env.VITE_API_URL);\r\n\r\nif (!resolvedBase) {\r\n  throw new Error('VITE_API_URL is not configured');\r\n}\r\n\r\nif (resolvedBase.appended) {\r\n  // eslint-disable-next-line no-console\r\n  console.warn('[scrollwise] VITE_API_URL was missing an /api segment; using', resolvedBase.base);\r\n}\r\n\r\nconst API_URL = resolvedBase.base;\r\n\r\nexport interface UploadResult {\r\n  sentIds: string[];\r\n  hasMore: boolean;\r\n  requestAuthRefresh?: boolean;\r\n}\r\n\r\nconst BATCH_SIZE = 80;\r\n\r\n// Simple mutex to avoid concurrent refreshes\r\nlet refreshPromise: Promise<boolean> | null = null;\r\n\r\nconst sleep = (ms: number) => new Promise(res => setTimeout(res, ms));\r\n\r\nconst refreshAccessToken = async (auth: AuthState) => {\r\n  if (refreshPromise) return refreshPromise;\r\n\r\n  refreshPromise = (async () => {\r\n    try {\r\n      const response = await fetch(`${API_URL}/auth/refresh`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ refreshToken: auth.refreshToken })\r\n      });\r\n\r\n      if (!response.ok) {\r\n        // disable tracking until user re-authenticates\r\n        await chrome.storage.local.set({ 'scrollwise-auth': { trackingEnabled: false } });\r\n        return false;\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      // merge existing state with new tokens\r\n      const stored = await chrome.storage.local.get('scrollwise-auth');\r\n      const prev = stored['scrollwise-auth'] ?? {};\r\n      await chrome.storage.local.set({\r\n        'scrollwise-auth': {\r\n          ...prev,\r\n          accessToken: data.tokens.accessToken,\r\n          refreshToken: data.tokens.refreshToken,\r\n          trackingEnabled: true\r\n        }\r\n      });\r\n\r\n      return true;\r\n    } catch (err) {\r\n      // network error - don't flip tracking flag here, caller will retry later\r\n      // eslint-disable-next-line no-console\r\n      console.warn('[scrollwise] refresh failed', (err as Error).message ?? err);\r\n      return false;\r\n    } finally {\r\n      refreshPromise = null;\r\n    }\r\n  })();\r\n\r\n  return refreshPromise;\r\n};\r\n\r\nexport const sendEventsToApi = async (auth: AuthState): Promise<UploadResult | undefined> => {\r\n  const queued = await getQueuedEvents();\r\n  if (!queued.length || !auth.accessToken) {\r\n    return undefined;\r\n  }\r\n\r\n  const batch = queued.slice(0, BATCH_SIZE);\r\n\r\n  // Build payload including idempotency keys (client-side queue ids)\r\n  const payload = { events: batch.map(item => ({ ...(item.event as any), idempotencyKey: item.id })) };\r\n\r\n  // try upload with a small retry/backoff loop\r\n  const maxAttempts = 3;\r\n  let attempt = 0;\r\n  let lastError: unknown = null;\r\n\r\n  while (attempt < maxAttempts) {\r\n    attempt += 1;\r\n    try {\r\n      const response = await fetch(`${API_URL}/tracking/events`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${auth.accessToken}`\r\n        },\r\n        body: JSON.stringify(payload)\r\n      });\r\n\r\n      if (response.status === 401 && auth.refreshToken) {\r\n        const refreshed = await refreshAccessToken(auth);\r\n        if (!refreshed) {\r\n          // cannot refresh, disable tracking and abort for now\r\n          return { sentIds: [], hasMore: true, requestAuthRefresh: false };\r\n        }\r\n\r\n        // tokens refreshed, reload updated auth from storage and retry once immediately\r\n        const stored = await chrome.storage.local.get('scrollwise-auth');\r\n        const updated = stored['scrollwise-auth'] as AuthState | undefined;\r\n        if (updated?.accessToken) {\r\n          auth = { ...auth, accessToken: updated.accessToken, refreshToken: updated.refreshToken };\r\n          // retry immediately without increasing attempt counter\r\n          continue;\r\n        }\r\n      }\r\n\r\n      if (!response.ok) {\r\n        lastError = new Error(`Failed to upload events: ${response.status}`);\r\n        // retry on server errors (5xx), but break for client errors\r\n        if (response.status >= 500) {\r\n          const backoff = 200 * Math.pow(2, attempt - 1);\r\n          await sleep(backoff);\r\n          continue;\r\n        }\r\n        throw lastError;\r\n      }\r\n\r\n      // success\r\n      await removeQueuedEvents(batch.map(item => item.id));\r\n      const remaining = await getQueuedEvents();\r\n      return {\r\n        sentIds: batch.map(item => item.id),\r\n        hasMore: remaining.length > 0\r\n      };\r\n    } catch (err) {\r\n      lastError = err;\r\n      // transient network error -> retry with backoff\r\n      const backoff = 200 * Math.pow(2, attempt - 1);\r\n      // eslint-disable-next-line no-console\r\n      console.warn('[scrollwise] upload attempt failed', attempt, (err as Error).message ?? err);\r\n      await sleep(backoff);\r\n      continue;\r\n    }\r\n  }\r\n\r\n  // exhausting attempts\r\n  if (lastError) throw lastError;\r\n  return undefined;\r\n};\r\n","import { clearAuthState, getAuthState, setAuthState, syncTrackingFlag } from '@/storage/auth';\r\nimport { clearQueue, enqueueEvents, getQueuedEvents } from '@/storage/queue';\r\nimport { sendEventsToApi } from '@/utils/api';\r\n\r\nconst TRACKING_ALARM = 'scrollwise-upload';\r\nlet uploadInFlight: Promise<void> | null = null;\r\nlet uploadQueued = false;\r\n\r\nconst processUploadQueue = (reason: 'alarm' | 'enqueue') => {\r\n  const schedule = async () => {\r\n    const auth = await getAuthState();\r\n    if (!auth?.accessToken) {\r\n      return;\r\n    }\r\n\r\n    const result = await sendEventsToApi(auth);\r\n    if (result?.sentIds?.length) {\r\n      chrome.runtime\r\n        .sendMessage({ type: 'SUMMARY_INVALIDATE' })\r\n        .catch(() => undefined);\r\n    }\r\n\r\n    if (result?.hasMore || result?.requestAuthRefresh) {\r\n      uploadQueued = true;\r\n    }\r\n  };\r\n\r\n  if (uploadInFlight) {\r\n    uploadQueued = true;\r\n    return;\r\n  }\r\n\r\n  uploadInFlight = schedule()\r\n    .catch(error => {\r\n      console.warn(`[scrollwise] upload failed (${reason})`, error);\r\n    })\r\n    .finally(() => {\r\n      uploadInFlight = null;\r\n      if (uploadQueued) {\r\n        uploadQueued = false;\r\n        processUploadQueue('enqueue');\r\n      }\r\n    });\r\n};\r\n\r\nchrome.runtime.onInstalled.addListener(() => {\r\n  chrome.alarms.create(TRACKING_ALARM, { periodInMinutes: 1 });\r\n});\r\n\r\nchrome.runtime.onStartup.addListener(async () => {\r\n  await syncTrackingFlag();\r\n  const pending = await getQueuedEvents();\r\n  if (pending.length) {\r\n    processUploadQueue('alarm');\r\n  }\r\n});\r\n\r\nchrome.runtime.onMessage.addListener((message, _sender, sendResponse) => {\r\n  if (message.type === 'TRACKING_EVENT') {\r\n    void enqueueEvents(message.payload)\r\n      .then(async () => {\r\n        processUploadQueue('enqueue');\r\n        sendResponse({ ok: true });\r\n      })\r\n      .catch(error => sendResponse({ ok: false, error }));\r\n    return true;\r\n  }\r\n  if (message.type === 'AUTH_UPDATE') {\r\n    void setAuthState(message.payload)\r\n      .then(async () => {\r\n        await syncTrackingFlag();\r\n        processUploadQueue('enqueue');\r\n        sendResponse({ ok: true });\r\n      })\r\n      .catch(error => sendResponse({ ok: false, error }));\r\n    return true;\r\n  }\r\n  if (message.type === 'AUTH_LOGOUT') {\r\n    clearAuthState()\r\n      .then(async () => {\r\n        await clearQueue();\r\n        await syncTrackingFlag();\r\n        sendResponse({ ok: true });\r\n      })\r\n      .catch(error => sendResponse({ ok: false, error }));\r\n    return true;\r\n  }\r\n  if (message.type === 'TRACKING_TOGGLE') {\r\n    syncTrackingFlag().then(() => sendResponse({ ok: true }));\r\n    return true;\r\n  }\r\n  if (message.type === 'TRACKING_STATUS_REQUEST') {\r\n    void getAuthState()\r\n      .then(state => {\r\n        const enabled = Boolean(state?.trackingEnabled && state?.accessToken);\r\n        sendResponse({ enabled });\r\n      })\r\n      .catch(error => sendResponse({ enabled: false, error: (error as Error)?.message ?? 'unknown' }));\r\n    return true;\r\n  }\r\n  return false;\r\n});\r\n\r\nchrome.alarms.onAlarm.addListener(async alarm => {\r\n  if (alarm.name !== TRACKING_ALARM) return;\r\n  const pending = await getQueuedEvents();\r\n  if (!pending.length) return;\r\n  processUploadQueue('alarm');\r\n});\r\n"],"names":["QUEUE_KEY","createQueuedEvent","event","normalizeQueue","raw","item","candidate","writeQueue","queue","readQueue","normalized","enqueueEvents","events","existing","next","getQueuedEvents","removeQueuedEvents","ids","filtered","clearQueue","stripTrailingSlash","value","hasApiSegment","resolveApiBase","trimmed","normalised","url","path","resolvedBase","API_URL","BATCH_SIZE","refreshPromise","sleep","ms","res","refreshAccessToken","auth","response","data","prev","err","sendEventsToApi","queued","batch","payload","maxAttempts","attempt","lastError","updated","backoff","remaining","TRACKING_ALARM","uploadInFlight","uploadQueued","processUploadQueue","reason","schedule","getAuthState","result","_a","error","syncTrackingFlag","message","_sender","sendResponse","setAuthState","clearAuthState","state","enabled","alarm"],"mappings":"mDAEA,MAAMA,EAAY,yBAOZC,EAAqBC,IAAyC,CAClE,GAAI,OAAO,OAAW,KAAe,eAAgB,OAAS,OAAO,WAAA,EAAe,GAAG,KAAK,IAAA,CAAK,IAAI,KAAK,QAAQ,GAClH,MAAAA,CACF,GAEMC,EAAkBC,GACjB,MAAM,QAAQA,CAAG,EAIfA,EAAI,IAAIC,GAAQ,CACrB,GAAIA,GAAQ,OAAOA,GAAS,UAAY,OAAQA,GAAQ,UAAWA,EAAM,CACvE,MAAMC,EAAYD,EAClB,GAAI,OAAOC,EAAU,IAAO,UAAYA,EAAU,MAChD,OAAOA,CAEX,CACA,OAAOL,EAAkBI,CAAuB,CAClD,CAAC,EAXQ,CAAA,EAcLE,EAAa,MAAOC,GAAyB,CAC7CA,EAAM,OACR,MAAM,OAAO,QAAQ,MAAM,IAAI,CAAE,CAACR,CAAS,EAAGQ,EAAO,EAErD,MAAM,OAAO,QAAQ,MAAM,OAAOR,CAAS,CAE/C,EAEMS,EAAY,SAAoC,CAEpD,MAAML,GADS,MAAM,OAAO,QAAQ,MAAM,IAAIJ,CAAS,GACpCA,CAAS,EACtBU,EAAaP,EAAeC,CAAG,EAErC,OADqB,MAAM,QAAQA,CAAG,GAAKA,EAAI,KAAKC,GAAQ,EAAEA,GAAQ,OAAOA,GAAS,UAAY,OAAQA,GAAQ,UAAWA,EAAK,GAC9GK,EAAW,QAC7B,MAAMH,EAAWG,CAAU,EAEtBA,CACT,EAEaC,EAAgB,MAAOC,GAA8B,CAChE,GAAI,CAACA,EAAO,OAAQ,MAAO,CAAA,EAC3B,MAAMC,EAAW,MAAMJ,EAAA,EACjBK,EAAOF,EAAO,IAAIX,CAAiB,EACzC,aAAMM,EAAW,CAAC,GAAGM,EAAU,GAAGC,CAAI,CAAC,EAChCA,EAAK,IAAIT,GAAQA,EAAK,EAAE,CACjC,EAEaU,EAAkB,SAAYN,EAAA,EAE9BO,EAAqB,MAAOC,GAAkB,CACzD,GAAI,CAACA,EAAI,OAAQ,OAEjB,MAAMC,GADW,MAAMT,EAAA,GACG,OAAOJ,GAAQ,CAACY,EAAI,SAASZ,EAAK,EAAE,CAAC,EAC/D,MAAME,EAAWW,CAAQ,CAC3B,EAEaC,EAAa,SAAY,CACpC,MAAM,OAAO,QAAQ,MAAM,OAAOnB,CAAS,CAC7C,EC/DMoB,EAAsBC,GAAkBA,EAAM,QAAQ,OAAQ,EAAE,EAChEC,EAAiBD,GAAkB,iBAAiB,KAAKA,CAAK,EAE9DE,EAAkBnB,GAA2C,CAEjE,MAAMoB,EAAUpB,EAAI,KAAA,EACpB,GAAI,CAACoB,EAAS,OAEd,MAAMC,EAAaL,EAAmBI,CAAO,EAE7C,GAAI,CACF,MAAME,EAAM,IAAI,IAAID,CAAU,EACxBE,EAAOP,EAAmBM,EAAI,UAAY,EAAE,EAClD,MAAI,CAACC,GAAQA,IAAS,IACpBD,EAAI,SAAW,OACR,CAAE,KAAMN,EAAmBM,EAAI,UAAU,EAAG,SAAU,EAAA,GAE3DJ,EAAcK,CAAI,GACpBD,EAAI,SAAWC,EACR,CAAE,KAAMP,EAAmBM,EAAI,UAAU,EAAG,SAAU,EAAA,IAE/DA,EAAI,SAAW,GAAGC,CAAI,OACf,CAAE,KAAMP,EAAmBM,EAAI,UAAU,EAAG,SAAU,EAAA,EAC/D,MAAQ,CACN,OAAIJ,EAAcG,CAAU,EACnB,CAAE,KAAMA,EAAY,SAAU,EAAA,EAEhC,CAAE,KAAM,GAAGA,CAAU,OAAQ,SAAU,EAAA,CAChD,CACF,EAEMG,EAAeL,EAAe,yCAA4B,EAEhE,GAAI,CAACK,EACH,MAAM,IAAI,MAAM,gCAAgC,EAG9CA,EAAa,UAEf,QAAQ,KAAK,+DAAgEA,EAAa,IAAI,EAGhG,MAAMC,EAAUD,EAAa,KAQvBE,EAAa,GAGnB,IAAIC,EAA0C,KAE9C,MAAMC,EAASC,GAAe,IAAI,QAAQC,GAAO,WAAWA,EAAKD,CAAE,CAAC,EAE9DE,EAAqB,MAAOC,GAC5BL,IAEJA,GAAkB,SAAY,CAC5B,GAAI,CACF,MAAMM,EAAW,MAAM,MAAM,GAAGR,CAAO,gBAAiB,CACtD,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,aAAcO,EAAK,aAAc,CAAA,CACzD,EAED,GAAI,CAACC,EAAS,GAEZ,aAAM,OAAO,QAAQ,MAAM,IAAI,CAAE,kBAAmB,CAAE,gBAAiB,EAAA,EAAS,EACzE,GAGT,MAAMC,EAAO,MAAMD,EAAS,KAAA,EAItBE,GADS,MAAM,OAAO,QAAQ,MAAM,IAAI,iBAAiB,GAC3C,iBAAiB,GAAK,CAAA,EAC1C,aAAM,OAAO,QAAQ,MAAM,IAAI,CAC7B,kBAAmB,CACjB,GAAGA,EACH,YAAaD,EAAK,OAAO,YACzB,aAAcA,EAAK,OAAO,aAC1B,gBAAiB,EAAA,CACnB,CACD,EAEM,EACT,OAASE,EAAK,CAGZ,eAAQ,KAAK,8BAAgCA,EAAc,SAAWA,CAAG,EAClE,EACT,QAAA,CACET,EAAiB,IACnB,CACF,GAAA,EAEOA,GAGIU,EAAkB,MAAOL,GAAuD,CAC3F,MAAMM,EAAS,MAAM3B,EAAA,EACrB,GAAI,CAAC2B,EAAO,QAAU,CAACN,EAAK,YAC1B,OAGF,MAAMO,EAAQD,EAAO,MAAM,EAAGZ,CAAU,EAGlCc,EAAU,CAAE,OAAQD,EAAM,IAAItC,IAAS,CAAE,GAAIA,EAAK,MAAe,eAAgBA,EAAK,EAAA,EAAK,CAAA,EAG3FwC,EAAc,EACpB,IAAIC,EAAU,EACVC,EAAqB,KAEzB,KAAOD,EAAUD,GAAa,CAC5BC,GAAW,EACX,GAAI,CACF,MAAMT,EAAW,MAAM,MAAM,GAAGR,CAAO,mBAAoB,CACzD,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAe,UAAUO,EAAK,WAAW,EAAA,EAE3C,KAAM,KAAK,UAAUQ,CAAO,CAAA,CAC7B,EAED,GAAIP,EAAS,SAAW,KAAOD,EAAK,aAAc,CAEhD,GAAI,CADc,MAAMD,EAAmBC,CAAI,EAG7C,MAAO,CAAE,QAAS,CAAA,EAAI,QAAS,GAAM,mBAAoB,EAAA,EAK3D,MAAMY,GADS,MAAM,OAAO,QAAQ,MAAM,IAAI,iBAAiB,GACxC,iBAAiB,EACxC,GAAIA,GAAA,MAAAA,EAAS,YAAa,CACxBZ,EAAO,CAAE,GAAGA,EAAM,YAAaY,EAAQ,YAAa,aAAcA,EAAQ,YAAA,EAE1E,QACF,CACF,CAEA,GAAI,CAACX,EAAS,GAAI,CAGhB,GAFAU,EAAY,IAAI,MAAM,4BAA4BV,EAAS,MAAM,EAAE,EAE/DA,EAAS,QAAU,IAAK,CAC1B,MAAMY,EAAU,IAAM,KAAK,IAAI,EAAGH,EAAU,CAAC,EAC7C,MAAMd,EAAMiB,CAAO,EACnB,QACF,CACA,MAAMF,CACR,CAGA,MAAM/B,EAAmB2B,EAAM,IAAItC,GAAQA,EAAK,EAAE,CAAC,EACnD,MAAM6C,EAAY,MAAMnC,EAAA,EACxB,MAAO,CACL,QAAS4B,EAAM,IAAItC,GAAQA,EAAK,EAAE,EAClC,QAAS6C,EAAU,OAAS,CAAA,CAEhC,OAASV,EAAK,CACZO,EAAYP,EAEZ,MAAMS,EAAU,IAAM,KAAK,IAAI,EAAGH,EAAU,CAAC,EAE7C,QAAQ,KAAK,qCAAsCA,EAAUN,EAAc,SAAWA,CAAG,EACzF,MAAMR,EAAMiB,CAAO,EACnB,QACF,CACF,CAGA,GAAIF,EAAW,MAAMA,CAEvB,ECpLMI,EAAiB,oBACvB,IAAIC,EAAuC,KACvCC,EAAe,GAEnB,MAAMC,EAAsBC,GAAgC,CAC1D,MAAMC,EAAW,SAAY,OAC3B,MAAMpB,EAAO,MAAMqB,EAAA,EACnB,GAAI,EAACrB,GAAA,MAAAA,EAAM,aACT,OAGF,MAAMsB,EAAS,MAAMjB,EAAgBL,CAAI,GACrCuB,EAAAD,GAAA,YAAAA,EAAQ,UAAR,MAAAC,EAAiB,QACnB,OAAO,QACJ,YAAY,CAAE,KAAM,qBAAsB,EAC1C,MAAM,IAAA,EAAe,GAGtBD,GAAA,MAAAA,EAAQ,SAAWA,GAAA,MAAAA,EAAQ,sBAC7BL,EAAe,GAEnB,EAEA,GAAID,EAAgB,CAClBC,EAAe,GACf,MACF,CAEAD,EAAiBI,EAAA,EACd,MAAMI,GAAS,CACd,QAAQ,KAAK,+BAA+BL,CAAM,IAAKK,CAAK,CAC9D,CAAC,EACA,QAAQ,IAAM,CACbR,EAAiB,KACbC,IACFA,EAAe,GACfC,EAAmB,SAAS,EAEhC,CAAC,CACL,EAEA,OAAO,QAAQ,YAAY,YAAY,IAAM,CAC3C,OAAO,OAAO,OAAOH,EAAgB,CAAE,gBAAiB,EAAG,CAC7D,CAAC,EAED,OAAO,QAAQ,UAAU,YAAY,SAAY,CAC/C,MAAMU,EAAA,GACU,MAAM9C,EAAA,GACV,QACVuC,EAAmB,OAAO,CAE9B,CAAC,EAED,OAAO,QAAQ,UAAU,YAAY,CAACQ,EAASC,EAASC,IAClDF,EAAQ,OAAS,kBACdnD,EAAcmD,EAAQ,OAAO,EAC/B,KAAK,SAAY,CAChBR,EAAmB,SAAS,EAC5BU,EAAa,CAAE,GAAI,GAAM,CAC3B,CAAC,EACA,MAAMJ,GAASI,EAAa,CAAE,GAAI,GAAO,MAAAJ,CAAA,CAAO,CAAC,EAC7C,IAELE,EAAQ,OAAS,eACdG,EAAaH,EAAQ,OAAO,EAC9B,KAAK,SAAY,CAChB,MAAMD,EAAA,EACNP,EAAmB,SAAS,EAC5BU,EAAa,CAAE,GAAI,GAAM,CAC3B,CAAC,EACA,MAAMJ,GAASI,EAAa,CAAE,GAAI,GAAO,MAAAJ,CAAA,CAAO,CAAC,EAC7C,IAELE,EAAQ,OAAS,eACnBI,EAAA,EACG,KAAK,SAAY,CAChB,MAAM/C,EAAA,EACN,MAAM0C,EAAA,EACNG,EAAa,CAAE,GAAI,GAAM,CAC3B,CAAC,EACA,MAAMJ,GAASI,EAAa,CAAE,GAAI,GAAO,MAAAJ,CAAA,CAAO,CAAC,EAC7C,IAELE,EAAQ,OAAS,mBACnBD,EAAA,EAAmB,KAAK,IAAMG,EAAa,CAAE,GAAI,EAAA,CAAM,CAAC,EACjD,IAELF,EAAQ,OAAS,2BACdL,EAAA,EACF,KAAKU,GAAS,CACb,MAAMC,EAAU,GAAQD,GAAA,MAAAA,EAAO,kBAAmBA,GAAA,MAAAA,EAAO,cACzDH,EAAa,CAAE,QAAAI,EAAS,CAC1B,CAAC,EACA,MAAMR,GAASI,EAAa,CAAE,QAAS,GAAO,OAAQJ,GAAA,YAAAA,EAAiB,UAAW,SAAA,CAAW,CAAC,EAC1F,IAEF,EACR,EAED,OAAO,OAAO,QAAQ,YAAY,MAAMS,GAAS,CAC3CA,EAAM,OAASlB,GAEf,EADY,MAAMpC,EAAA,GACT,QACbuC,EAAmB,OAAO,CAC5B,CAAC"}